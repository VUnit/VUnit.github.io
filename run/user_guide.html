
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Run Library &#8212; VUnit  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/vunit.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Communication Library" href="../com/user_guide.html" />
    <link rel="prev" title="Check Library" href="../check/user_guide.html" />
  

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112393863-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-112393863-1');
</script>

  
  <link rel="alternate" type="application/atom+xml"  href="../blog/atom.xml" title="VUnit Blog">
  
  
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="run-library">
<span id="id1"></span><h1>Run Library<a class="headerlink" href="#run-library" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The VHDL run library is a number of VHDL packages providing functionality for running a VUnit testbench.
This functionality is also known as the VHDL test runner (VR). It’s possible to run a VUnit testbench standalone,
just using VR, but the highly recommended approach and the main focus of this user guide is to use VR together
with the Python-based test runner (PR) documented in this <a class="reference internal" href="../user_guide.html"><span class="doc">user guide</span></a> and
<a class="reference internal" href="../py/ui.html"><span class="doc">API documentation</span></a>.</p>
</div>
<div class="section" id="minimal-vunit-testbench">
<h2>Minimal VUnit Testbench<a class="headerlink" href="#minimal-vunit-testbench" title="Permalink to this headline">¶</a></h2>
<p>A (close to) minimal VUnit testbench looks like this</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">vunit_lib</span><span class="p">;</span>
<span class="n">context</span> <span class="n">vunit_lib</span><span class="p">.</span><span class="n">vunit_context</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">tb_minimal</span> <span class="k">is</span>
  <span class="k">generic</span> <span class="p">(</span><span class="n">runner_cfg</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">:=</span> <span class="n">runner_cfg_default</span><span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">tb</span> <span class="k">of</span> <span class="nc">tb_minimal</span> <span class="k">is</span>
<span class="k">begin</span>
  <span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
  <span class="k">begin</span>
    <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>
    <span class="n">check_equal</span><span class="p">(</span><span class="n">to_string</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span> <span class="s">&quot;17&quot;</span><span class="p">);</span>
    <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>
<span class="k">end</span> <span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
<p>It has the following important properties</p>
<ul class="simple">
<li><p>The VUnit functionality is located in the <code class="docutils literal notranslate"><span class="pre">vunit_lib</span></code> library and is included with the library and context
statements in the first two lines.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> generic is used to control the testbench from PR. If the testbench is used standalone you will
need a default value, <code class="docutils literal notranslate"><span class="pre">runner_cfg_default</span></code>, for the generic. Note that the generic <strong>must</strong> be named
<code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> for the testbench to be recognized by PR (there is an exception which we’ll get to later).</p></li>
<li><p>Every VUnit testbench has a main controlling process. It’s labelled <code class="docutils literal notranslate"><span class="pre">test_runner</span></code> in this example but the name
is not important. The process starts by setting up VUnit using the <code class="docutils literal notranslate"><span class="pre">test_runner_setup</span></code> procedure with
<code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> as the second parameter. <code class="docutils literal notranslate"><span class="pre">runner</span></code> is a globally defined signal used to synchronize activities
internal to VUnit. The process ends with a call to the <code class="docutils literal notranslate"><span class="pre">test_runner_cleanup</span></code> procedure which will force the
simulation to a stop.</p></li>
<li><p>Since the call to <code class="docutils literal notranslate"><span class="pre">test_runner_cleanup</span></code> ends the simulation you’ll need to execute your test code before that.
You can put the test code directly between <code class="docutils literal notranslate"><span class="pre">test_runner_setup</span></code> and <code class="docutils literal notranslate"><span class="pre">test_runner_cleanup</span></code> or you can simply
use that region to trigger and wait for test activities performed elsewhere (for example in other processes) or
you can mix those strategies. In this case the test code is in the same process and it uses the <code class="docutils literal notranslate"><span class="pre">check_equal</span></code>
procedure from the <a class="reference internal" href="../check/user_guide.html"><span class="doc">check library</span></a></p></li>
</ul>
<p>Running this testbench using PR will result in something like this</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python run.py
<span class="go">Starting lib.tb_minimal.all</span>
<span class="go">pass (P=1 S=0 F=0 T=1) lib.tb_minimal.all (1.1 seconds)</span>

<span class="go">==== Summary ==============================</span>
<span class="go">pass lib.tb_minimal.all (1.1 seconds)</span>
<span class="go">===========================================</span>
<span class="go">pass 1 of 1</span>
<span class="go">===========================================</span>
<span class="go">Total time was 1.1 seconds</span>
<span class="go">Elapsed time was 1.1 seconds</span>
<span class="go">===========================================</span>
<span class="go">All passed!</span>
</pre></div>
</div>
</div>
<div class="section" id="testbench-with-test-cases">
<h2>Testbench with Test Cases<a class="headerlink" href="#testbench-with-test-cases" title="Permalink to this headline">¶</a></h2>
<p>A VUnit testbench can be structured around a set of test cases called a test suite. This will emphasize the
functionality being verified by the testbench.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
<span class="k">begin</span>
  <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>

  <span class="c1">-- Put test suite setup code here</span>

  <span class="k">while</span> <span class="n">test_suite</span> <span class="k">loop</span>

    <span class="c1">-- Put common test case setup code here</span>

    <span class="k">if</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test to_string for integer&quot;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">check_equal</span><span class="p">(</span><span class="n">to_string</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span> <span class="s">&quot;17&quot;</span><span class="p">);</span>
    <span class="k">elsif</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test to_string for boolean&quot;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">check_equal</span><span class="p">(</span><span class="n">to_string</span><span class="p">(</span><span class="n">true</span><span class="p">),</span> <span class="s">&quot;true&quot;</span><span class="p">);</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>

    <span class="c1">-- Put common test case cleanup code here</span>

  <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

  <span class="c1">-- Put test suite cleanup code here</span>

  <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
<span class="k">end</span> <span class="k">process</span><span class="p">;</span>
</pre></div>
</div>
<p>This testbench has two test cases named <em>Test to_string for integer</em> and <em>Test to_string for boolean</em>.
If a test case has been enabled by the <code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> the corresponding <code class="docutils literal notranslate"><span class="pre">run</span></code> function call will return <code class="docutils literal notranslate"><span class="pre">true</span></code>
the <strong>first</strong> time it is called and the test code in that (els)if branch is executed. All test code can be in
the branch as in the example or the branch can be used to coordinate activities elsewhere in the testbench.</p>
<p><code class="docutils literal notranslate"><span class="pre">test_suite</span></code> is a function that will return <code class="docutils literal notranslate"><span class="pre">true</span></code> and keep the while loop running as long as there are
enabled test cases left to run.</p>
<p>Note that there is no need to register the test cases anywhere. PR will scan your testbenches for <code class="docutils literal notranslate"><span class="pre">run</span></code> function
calls to find all test cases. These <code class="docutils literal notranslate"><span class="pre">run</span></code>  functions must have a string literal as the name parameter to be
found by PR.</p>
<p>A VUnit testbench naturally runs through a number of <em>phases</em>. The first is the test runner setup phase implemented
by the procedure with the same name and the last is the test runner cleanup phase. In between there are a number
of setup/cleanup phases for the test suite and the test cases. The code for these phases, if any, is defined by the
user and it’s placed as indicated by the comments in the example. These phases are typically used for things like
setting up support packages, resetting the DUT, reading/writing test data from/to file, and synchronizing
testbench activities.</p>
<p>Running this testbench gives the following output</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python run.py
<span class="go">Starting lib.tb_with_test_cases.Test to_string for integer</span>
<span class="go">pass (P=1 S=0 F=0 T=2) lib.tb_with_test_cases.Test to_string for integer (1.1 seconds)</span>

<span class="go">Starting lib.tb_with_test_cases.Test to_string for boolean</span>
<span class="go">pass (P=2 S=0 F=0 T=2) lib.tb_with_test_cases.Test to_string for boolean (1.1 seconds)</span>

<span class="go">==== Summary =============================================================</span>
<span class="go">pass lib.tb_with_test_cases.Test to_string for integer (1.1 seconds)</span>
<span class="go">pass lib.tb_with_test_cases.Test to_string for boolean (1.1 seconds)</span>
<span class="go">==========================================================================</span>
<span class="go">pass 2 of 2</span>
<span class="go">==========================================================================</span>
<span class="go">Total time was 2.1 seconds</span>
<span class="go">Elapsed time was 2.1 seconds</span>
<span class="go">==========================================================================</span>
<span class="go">All passed!</span>
</pre></div>
</div>
</div>
<div class="section" id="distributed-testbenches">
<h2>Distributed Testbenches<a class="headerlink" href="#distributed-testbenches" title="Permalink to this headline">¶</a></h2>
<p>Some testbenches with a more distributed control may have several processes which operations depend on the
currently running test case. However, there can be only one call to the <code class="docutils literal notranslate"><span class="pre">run(&quot;Name</span> <span class="pre">of</span> <span class="pre">test</span> <span class="pre">case&quot;)</span></code> function
or VUnit will think that you’ve several test cases with the same name and that is not allowed (in the same
testbench). The way to solve this is to use the <code class="docutils literal notranslate"><span class="pre">running_test_case</span></code> function which will return the name of the
running test case. Here is an example of how it can be used (<code class="docutils literal notranslate"><span class="pre">info</span></code> is a procedure from the
<a class="reference internal" href="../logging/user_guide.html"><span class="doc">logging library</span></a>).</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">architecture</span> <span class="nc">tb</span> <span class="k">of</span> <span class="nc">tb_running_test_case</span> <span class="k">is</span>
  <span class="k">signal</span> <span class="n">start_stimuli</span><span class="p">,</span> <span class="n">stimuli_done</span> <span class="o">:</span> <span class="kt">boolean</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
  <span class="k">begin</span>
    <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>

    <span class="k">while</span> <span class="n">test_suite</span> <span class="k">loop</span>
      <span class="k">if</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test scenario A&quot;</span><span class="p">)</span> <span class="k">or</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test scenario B&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">start_stimuli</span> <span class="o">&lt;=</span> <span class="n">true</span><span class="p">;</span>
        <span class="k">wait</span> <span class="k">until</span> <span class="n">stimuli_done</span><span class="p">;</span>
      <span class="k">elsif</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test something else&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">info</span><span class="p">(</span><span class="s">&quot;Testing something else&quot;</span><span class="p">);</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

    <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="nc">stimuli_generator</span><span class="o">:</span> <span class="k">process</span> <span class="k">is</span>
  <span class="k">begin</span>
    <span class="k">wait</span> <span class="k">until</span> <span class="n">start_stimuli</span><span class="p">;</span>

    <span class="k">if</span> <span class="n">running_test_case</span> <span class="o">=</span> <span class="s">&quot;Test scenario A&quot;</span> <span class="k">then</span>
      <span class="n">info</span><span class="p">(</span><span class="s">&quot;Applying stimuli for scenario A&quot;</span><span class="p">);</span>
    <span class="k">elsif</span> <span class="n">running_test_case</span> <span class="o">=</span> <span class="s">&quot;Test scenario B&quot;</span> <span class="k">then</span>
      <span class="n">info</span><span class="p">(</span><span class="s">&quot;Applying stimuli for scenario B&quot;</span><span class="p">);</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>

    <span class="n">stimuli_done</span> <span class="o">&lt;=</span> <span class="n">true</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">process</span> <span class="nc">stimuli_generator</span><span class="p">;</span>

<span class="k">end</span> <span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">running_test_case</span></code> will return the test case name when the <code class="docutils literal notranslate"><span class="pre">run</span></code> function for the currently running test case
has been called and continue to return that name until a <code class="docutils literal notranslate"><span class="pre">run</span></code> function has been called again. Before the first
call to <code class="docutils literal notranslate"><span class="pre">run</span></code> or after a call to <code class="docutils literal notranslate"><span class="pre">run</span></code> returning <code class="docutils literal notranslate"><span class="pre">false</span></code> <code class="docutils literal notranslate"><span class="pre">running_test_case</span></code> will return the empty string
(<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>).</p>
<p>There’s also a similar function <code class="docutils literal notranslate"><span class="pre">active_test_case</span></code> which returns a test case name within all parts of the
<code class="docutils literal notranslate"><span class="pre">test_suite</span></code> loop. However, this function is not supported when running the testbench standalone without PR.
This mode of operation is described later in this guide.</p>
<p>In the examples described so far the main controlling process has been placed in the top-level entity. It’s also
possible to move this to a lower-level entity. To do that the <code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> generic has to be passed down to
that entity. However, the generic in that lower-level entity <strong>must not</strong> be called <code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> since PR
considers every VHDL file with a <code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> generic a top-level testbench to simulate. So the testbench
top-level can look like this</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">vunit_lib</span><span class="p">;</span>
<span class="n">context</span> <span class="n">vunit_lib</span><span class="p">.</span><span class="n">vunit_context</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">tb_with_lower_level_control</span> <span class="k">is</span>
  <span class="k">generic</span> <span class="p">(</span><span class="n">runner_cfg</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">:=</span> <span class="n">runner_cfg_default</span><span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">tb</span> <span class="k">of</span> <span class="nc">tb_with_lower_level_control</span> <span class="k">is</span>
<span class="k">begin</span>

  <span class="n">test_control</span><span class="o">:</span> <span class="k">entity</span> <span class="nc">work</span><span class="p">.</span><span class="n">test_control</span>
    <span class="k">generic</span> <span class="k">map</span> <span class="p">(</span>
      <span class="n">nested_runner_cfg</span> <span class="o">=&gt;</span> <span class="n">runner_cfg</span><span class="p">);</span>

<span class="k">end</span> <span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
<p>And the lower-level entity like this</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">vunit_lib</span><span class="p">;</span>
<span class="n">context</span> <span class="n">vunit_lib</span><span class="p">.</span><span class="n">vunit_context</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">test_control</span> <span class="k">is</span>
  <span class="k">generic</span> <span class="p">(</span>
    <span class="n">nested_runner_cfg</span> <span class="o">:</span> <span class="kt">string</span><span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span> <span class="nc">test_control</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">tb</span> <span class="k">of</span> <span class="nc">test_control</span> <span class="k">is</span>
<span class="k">begin</span>
  <span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
  <span class="k">begin</span>
    <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">nested_runner_cfg</span><span class="p">);</span>

    <span class="k">while</span> <span class="n">test_suite</span> <span class="k">loop</span>
      <span class="k">if</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test something&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">info</span><span class="p">(</span><span class="s">&quot;Testing something&quot;</span><span class="p">);</span>
      <span class="k">elsif</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test something else&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">info</span><span class="p">(</span><span class="s">&quot;Testing something else&quot;</span><span class="p">);</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

    <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>
<span class="k">end</span> <span class="k">architecture</span> <span class="nc">tb</span><span class="p">;</span>
</pre></div>
</div>
<p>The default PR behaviour is to scan all VHDL files with an entity containing a <code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> generic for
test cases to run. Now that that the lower-level entity uses another generic name you have to use the
<a class="reference internal" href="../py/vunit.html"><span class="doc">scan_tests_from_file</span></a> method in your run script.</p>
</div>
<div class="section" id="controlling-what-test-cases-to-run">
<h2>Controlling What Test Cases to Run<a class="headerlink" href="#controlling-what-test-cases-to-run" title="Permalink to this headline">¶</a></h2>
<p>When working with VUnit you will eventually end up with many testbenches and test cases. So far we have</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python run.py --list
<span class="go">lib.tb_minimal.all</span>
<span class="go">lib.tb_running_test_case.Test scenario A</span>
<span class="go">lib.tb_running_test_case.Test scenario B</span>
<span class="go">lib.tb_running_test_case.Test something else</span>
<span class="go">lib.tb_with_lower_level_control.all</span>
<span class="go">lib.tb_with_test_cases.Test to_string for integer</span>
<span class="go">lib.tb_with_test_cases.Test to_string for boolean</span>
<span class="go">Listed 7 tests</span>
</pre></div>
</div>
<p>You can control what testbenches and test cases to run from the command line by listing their names and/or using
patterns. For example</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python run.py *min* *integer
<span class="go">Starting lib.tb_minimal.all</span>
<span class="go">pass (P=1 S=0 F=0 T=2) lib.tb_minimal.all (1.0 seconds)</span>

<span class="go">Starting lib.tb_with_test_cases.Test to_string for integer</span>
<span class="go">pass (P=2 S=0 F=0 T=2) lib.tb_with_test_cases.Test to_string for integer (1.1 seconds)</span>

<span class="go">==== Summary =============================================================</span>
<span class="go">pass lib.tb_minimal.all                                (1.0 seconds)</span>
<span class="go">pass lib.tb_with_test_cases.Test to_string for integer (1.1 seconds)</span>
<span class="go">==========================================================================</span>
<span class="go">pass 2 of 2</span>
<span class="go">==========================================================================</span>
<span class="go">Total time was 2.1 seconds</span>
<span class="go">Elapsed time was 2.1 seconds</span>
<span class="go">==========================================================================</span>
<span class="go">All passed!</span>
</pre></div>
</div>
<p>PR will simulate matching testbenches and use <code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> to control what test cases to run.</p>
</div>
<div class="section" id="running-test-cases-independently">
<h2>Running Test Cases Independently<a class="headerlink" href="#running-test-cases-independently" title="Permalink to this headline">¶</a></h2>
<p>The test suite while loop presented earlier iterates over all enabled test cases but the default behaviour of
VUnit is to run all test cases in separate simulations, only enabling one test case at a time. There are several
good reasons for this</p>
<ul class="simple">
<li><p>The pass/fail status of a test case is based on its own merits and is not a side effect of other test cases.
This makes it easier to trust the information in the test report.</p></li>
<li><p>A failing test case, causing the simulation to stop, won’t prevent the other test cases in the testbench from
running</p></li>
<li><p>You can save time by just running one of many slow test cases if that’s sufficient for a specific test run.</p></li>
<li><p>You can run test cases in parallel threads using the multicore capabilities of your computer. Below all three
tests are run in parallel using the <code class="docutils literal notranslate"><span class="pre">-p</span></code> option. Note the 3x difference between the total simulation time and
the elapsed time.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python run.py -p3 *min* *test_cases*
<span class="go">Starting lib.tb_minimal.all</span>
<span class="go">Starting lib.tb_with_test_cases.Test to_string for integer</span>
<span class="go">Starting lib.tb_with_test_cases.Test to_string for boolean</span>
<span class="go">pass (P=1 S=0 F=0 T=3) lib.tb_minimal.all (1.0 seconds)</span>

<span class="go">pass (P=2 S=0 F=0 T=3) lib.tb_with_test_cases.Test to_string for boolean (1.1 seconds)</span>

<span class="go">pass (P=3 S=0 F=0 T=3) lib.tb_with_test_cases.Test to_string for integer (1.1 seconds)</span>

<span class="go">==== Summary =============================================================</span>
<span class="go">pass lib.tb_minimal.all                                (1.0 seconds)</span>
<span class="go">pass lib.tb_with_test_cases.Test to_string for boolean (1.1 seconds)</span>
<span class="go">pass lib.tb_with_test_cases.Test to_string for integer (1.1 seconds)</span>
<span class="go">==========================================================================</span>
<span class="go">pass 3 of 3</span>
<span class="go">==========================================================================</span>
<span class="go">Total time was 3.2 seconds</span>
<span class="go">Elapsed time was 1.1 seconds</span>
<span class="go">==========================================================================</span>
<span class="go">All passed!</span>
</pre></div>
</div>
<p>Possible drawbacks to this approach are that test cases have to be independent and the overhead
of starting a new simulation for each test case (this is typically less than one second per test case). If that
is the case you can force all test cases of a testbench to be run in the same simulation. This is done by adding
the <code class="docutils literal notranslate"><span class="pre">run_all_in_same_sim</span></code> attribute.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="c1">-- vunit: run_all_in_same_sim</span>

<span class="k">library</span> <span class="nn">vunit_lib</span><span class="p">;</span>
<span class="n">context</span> <span class="n">vunit_lib</span><span class="p">.</span><span class="n">vunit_context</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">tb_with_test_cases</span> <span class="k">is</span>
  <span class="k">generic</span> <span class="p">(</span><span class="n">runner_cfg</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">:=</span> <span class="n">runner_cfg_default</span><span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">tb</span> <span class="k">of</span> <span class="nc">tb_with_test_cases</span> <span class="k">is</span>
<span class="k">begin</span>
  <span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
  <span class="k">begin</span>
    <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>

    <span class="k">while</span> <span class="n">test_suite</span> <span class="k">loop</span>
      <span class="k">if</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test to_string for integer&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">check_equal</span><span class="p">(</span><span class="n">to_string</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span> <span class="s">&quot;17&quot;</span><span class="p">);</span>
      <span class="k">elsif</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test to_string for boolean&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">check_equal</span><span class="p">(</span><span class="n">to_string</span><span class="p">(</span><span class="n">true</span><span class="p">),</span> <span class="s">&quot;true&quot;</span><span class="p">);</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

    <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>
<span class="k">end</span> <span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-vunit-watchdog">
<h2>The VUnit Watchdog<a class="headerlink" href="#the-vunit-watchdog" title="Permalink to this headline">¶</a></h2>
<p>Sometimes your design has a bug causing a test case to stall indefinitely, maybe preventing a nightly test run from
proceeding. To avoid this VUnit provides a watchdog which will timeout and fail a test case after a specified time.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">architecture</span> <span class="nc">tb</span> <span class="k">of</span> <span class="nc">tb_with_watchdog</span> <span class="k">is</span>
<span class="k">begin</span>
  <span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
  <span class="k">begin</span>
    <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>

    <span class="k">while</span> <span class="n">test_suite</span> <span class="k">loop</span>
      <span class="k">if</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test that stalls&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="k">wait</span><span class="p">;</span>
      <span class="k">elsif</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test to_string for boolean&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">check_equal</span><span class="p">(</span><span class="n">to_string</span><span class="p">(</span><span class="n">true</span><span class="p">),</span> <span class="s">&quot;true&quot;</span><span class="p">);</span>
      <span class="k">elsif</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test that needs longer timeout&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- It is also possible to set/re-set the timeout</span>
        <span class="c1">-- When test cases need separate timeout settings</span>
        <span class="n">set_timeout</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="mi">2</span> <span class="n">ms</span><span class="p">);</span>
        <span class="k">wait</span> <span class="k">for</span> <span class="mi">1</span> <span class="n">ms</span><span class="p">;</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

    <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>

  <span class="n">test_runner_watchdog</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="mi">10</span> <span class="n">ms</span><span class="p">);</span>
<span class="k">end</span> <span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
<p>Note that the problem with the first test case doesn’t prevent the second from running.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python run.py *watchdog*
<span class="go">Starting lib.tb_with_watchdog.Test that stalls</span>
<span class="go">  10000000000000 fs - runner -   ERROR - Test runner timeout after 10000000000000 fs.</span>
<span class="go">D:\Programming\github\vunit\vunit\vhdl\core\src\core_pkg.vhd:84:7:@10ms:(report failure): Stop simulation on log level error</span>
<span class="go">C:\ghdl\dev\bin\ghdl.exe:error: report failed</span>
<span class="go">  from: vunit_lib.core_pkg.core_failure at core_pkg.vhd:84</span>
<span class="go">  from: vunit_lib.logger_pkg.count_log at logger_pkg-body.vhd:563</span>
<span class="go">  from: vunit_lib.logger_pkg.log at logger_pkg-body.vhd:711</span>
<span class="go">  from: vunit_lib.logger_pkg.error at logger_pkg-body.vhd:752</span>
<span class="go">  from: vunit_lib.run_pkg.test_runner_watchdog at run.vhd:368</span>
<span class="go">  from: process lib.tb_with_watchdog(tb).P0 at tb_with_watchdog.vhd:25</span>
<span class="go">C:\ghdl\dev\bin\ghdl.exe:error: simulation failed</span>
<span class="go">fail (P=0 S=0 F=1 T=2) lib.tb_with_watchdog.Test that stalls (0.3 seconds)</span>

<span class="go">Starting lib.tb_with_watchdog.Test to_string for boolean</span>
<span class="go">pass (P=1 S=0 F=1 T=2) lib.tb_with_watchdog.Test to_string for boolean (0.3 seconds)</span>

<span class="go">==== Summary ===========================================================</span>
<span class="go">pass lib.tb_with_watchdog.Test to_string for boolean     (0.3 seconds)</span>
<span class="go">pass lib.tb_with_watchdog.Test that needs longer timeout (0.3 seconds)</span>
<span class="go">fail lib.tb_with_watchdog.Test that stalls               (0.3 seconds)</span>
<span class="go">========================================================================</span>
<span class="go">pass 1 of 2</span>
<span class="go">fail 1 of 2</span>
<span class="go">========================================================================</span>
<span class="go">Total time was 0.5 seconds</span>
<span class="go">Elapsed time was 0.5 seconds</span>
<span class="go">========================================================================</span>
</pre></div>
</div>
</div>
<div class="section" id="what-makes-a-test-fail">
<h2>What Makes a Test Fail?<a class="headerlink" href="#what-makes-a-test-fail" title="Permalink to this headline">¶</a></h2>
<div class="section" id="stopping-failures">
<h3>Stopping Failures<a class="headerlink" href="#stopping-failures" title="Permalink to this headline">¶</a></h3>
<p>Anything that stops the simulation before the <code class="docutils literal notranslate"><span class="pre">test_runner_cleanup</span></code> procedure is called will cause a failing
test.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
  <span class="k">variable</span> <span class="n">my_vector</span> <span class="o">:</span> <span class="n">integer_vector</span><span class="p">(</span><span class="mi">1</span> <span class="k">to</span> <span class="mi">17</span><span class="p">);</span>
<span class="k">begin</span>
  <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>

  <span class="k">while</span> <span class="n">test_suite</span> <span class="k">loop</span>
    <span class="k">if</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test that fails on an assert&quot;</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">assert</span> <span class="n">false</span><span class="p">;</span>
    <span class="k">elsif</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test that crashes on boundary problems&quot;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">report</span> <span class="n">to_string</span><span class="p">(</span><span class="n">my_vector</span><span class="p">(</span><span class="n">runner_cfg</span><span class="na">&#39;length</span><span class="p">));</span>
    <span class="k">elsif</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test that fails on VUnit check procedure&quot;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">check_equal</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

  <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
<span class="k">end</span> <span class="k">process</span><span class="p">;</span>
</pre></div>
</div>
<p>All these test cases will fail</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python run.py *ways*
<span class="go">Starting lib.tb_many_ways_to_fail.Test that fails on an assert</span>
<span class="go">d:\Programming\github\vunit\examples\vhdl\run\tb_many_ways_to_fail.vhd:17:9:@0ms:(assertion error): Assertion violation</span>
<span class="go">C:\ghdl\dev\bin\ghdl.exe:error: assertion failed</span>
<span class="go">  from: process lib.tb_many_ways_to_fail(tb).test_runner at tb_many_ways_to_fail.vhd:17</span>
<span class="go">C:\ghdl\dev\bin\ghdl.exe:error: simulation failed</span>
<span class="go">fail (P=0 S=0 F=1 T=3) lib.tb_many_ways_to_fail.Test that fails on an assert (0.3 seconds)</span>

<span class="go">Starting lib.tb_many_ways_to_fail.Test that crashes on boundary problems</span>
<span class="go">C:\ghdl\dev\bin\ghdl.exe:error: bound check failure at d:\Programming\github\vunit\examples\vhdl\run\tb_many_ways_to_fail.vhd:19</span>
<span class="go">  from: process lib.tb_many_ways_to_fail(tb).test_runner at tb_many_ways_to_fail.vhd:19</span>
<span class="go">C:\ghdl\dev\bin\ghdl.exe:error: simulation failed</span>
<span class="go">fail (P=0 S=0 F=2 T=3) lib.tb_many_ways_to_fail.Test that crashes on boundary problems (0.3 seconds)</span>

<span class="go">Starting lib.tb_many_ways_to_fail.Test that fails on VUnit check procedure</span>
<span class="go">               0 fs - check                -   ERROR - Equality check failed - Got 17. Expected 18.</span>
<span class="go">D:\Programming\github\vunit\vunit\vhdl\core\src\core_pkg.vhd:84:7:@0ms:(report failure): Stop simulation on log level error</span>
<span class="go">C:\ghdl\dev\bin\ghdl.exe:error: report failed</span>
<span class="go">  from: vunit_lib.core_pkg.core_failure at core_pkg.vhd:84</span>
<span class="go">  from: vunit_lib.logger_pkg.count_log at logger_pkg-body.vhd:563</span>
<span class="go">  from: vunit_lib.logger_pkg.log at logger_pkg-body.vhd:711</span>
<span class="go">  from: vunit_lib.checker_pkg.failing_check at checker_pkg.vhd:238</span>
<span class="go">  from: vunit_lib.check_pkg.check_equal at check.vhd:3544</span>
<span class="go">  from: vunit_lib.check_pkg.check_equal at check.vhd:3501</span>
<span class="go">  from: process lib.tb_many_ways_to_fail(tb).test_runner at tb_many_ways_to_fail.vhd:21</span>
<span class="go">C:\ghdl\dev\bin\ghdl.exe:error: simulation failed</span>
<span class="go">fail (P=0 S=0 F=3 T=3) lib.tb_many_ways_to_fail.Test that fails on VUnit check procedure (0.3 seconds)</span>

<span class="go">==== Summary =============================================================================</span>
<span class="go">fail lib.tb_many_ways_to_fail.Test that fails on an assert             (0.3 seconds)</span>
<span class="go">fail lib.tb_many_ways_to_fail.Test that crashes on boundary problems   (0.3 seconds)</span>
<span class="go">fail lib.tb_many_ways_to_fail.Test that fails on VUnit check procedure (0.3 seconds)</span>
<span class="go">==========================================================================================</span>
<span class="go">pass 0 of 3</span>
<span class="go">fail 3 of 3</span>
<span class="go">==========================================================================================</span>
<span class="go">Total time was 0.8 seconds</span>
<span class="go">Elapsed time was 0.8 seconds</span>
<span class="go">==========================================================================================</span>
<span class="go">Some failed!</span>
</pre></div>
</div>
</div>
<div class="section" id="counting-errors-with-vunit-logging-check-libraries">
<h3>Counting Errors with VUnit Logging/Check Libraries<a class="headerlink" href="#counting-errors-with-vunit-logging-check-libraries" title="Permalink to this headline">¶</a></h3>
<p>If you use the VUnit check/logging library you can set the <a class="reference internal" href="../logging/user_guide.html"><span class="doc">stop_level</span></a> such that the
simulation continues on an error. Such errors will be remembered and the test will fail despite
reaching the <code class="docutils literal notranslate"><span class="pre">test_runner_cleanup</span></code> call.</p>
<p>By default <code class="docutils literal notranslate"><span class="pre">test_runner_cleanup</span></code> will fail if there were any error
or failure log even if they where disabled. Disabled errors or
failures can be allowed using the <code class="docutils literal notranslate"><span class="pre">allow_disabled_errors</span></code> or
<code class="docutils literal notranslate"><span class="pre">allow_disabled_failures</span></code> flags. Warnings can also optionally cause
failure by setting the <code class="docutils literal notranslate"><span class="pre">fail_on_warning</span></code> flag.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
<span class="k">begin</span>
  <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>
  <span class="n">set_stop_level</span><span class="p">(</span><span class="n">failure</span><span class="p">);</span>

  <span class="k">while</span> <span class="n">test_suite</span> <span class="k">loop</span>
    <span class="k">if</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test that fails multiple times but doesn&#39;t stop&quot;</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">check_equal</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
      <span class="n">check_equal</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
    <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

  <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
<span class="k">end</span> <span class="k">process</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python run.py *count*
<span class="go">Starting lib.tb_counting_errors.Test that fails multiple times but doesn&#39;t stop</span>
<span class="go">               0 fs - check                -   ERROR - Equality check failed - Got 17. Expected 18.</span>
<span class="go">               0 fs - check                -   ERROR - Equality check failed - Got 17. Expected 19.</span>
<span class="go">FAILURE - Logger check has 2 errors</span>
<span class="go">fail (P=0 S=0 F=1 T=1) lib.tb_counting_errors.Test that fails multiple times but doesn&#39;t stop (0.3 seconds)</span>

<span class="go">==== Summary ==================================================================================</span>
<span class="go">fail lib.tb_counting_errors.Test that fails multiple times but doesn&#39;t stop (0.3 seconds)</span>
<span class="go">===============================================================================================</span>
<span class="go">pass 0 of 1</span>
<span class="go">fail 1 of 1</span>
<span class="go">===============================================================================================</span>
<span class="go">Total time was 0.3 seconds</span>
<span class="go">Elapsed time was 0.3 seconds</span>
<span class="go">===============================================================================================</span>
<span class="go">Some failed!</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-a-vunit-testbench-standalone">
<h2>Running A VUnit Testbench Standalone<a class="headerlink" href="#running-a-vunit-testbench-standalone" title="Permalink to this headline">¶</a></h2>
<p>A VUnit testbench can be run just like any other VHDL testbench without involving PR. This is not the recommended
way of working but can be useful in an organization which has started to use, but not fully adopted, VUnit. If
you simulate the testbench below without PR the <code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code> generic will have the
value <code class="docutils literal notranslate"><span class="pre">runner_cfg_default</span></code> which will cause all test cases to be run.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">vunit_lib</span><span class="p">;</span>
<span class="n">context</span> <span class="n">vunit_lib</span><span class="p">.</span><span class="n">vunit_context</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">tb_standalone</span> <span class="k">is</span>
  <span class="k">generic</span> <span class="p">(</span><span class="n">runner_cfg</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">:=</span> <span class="n">runner_cfg_default</span><span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">tb</span> <span class="k">of</span> <span class="nc">tb_standalone</span> <span class="k">is</span>
<span class="k">begin</span>
  <span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
  <span class="k">begin</span>
    <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>

    <span class="k">while</span> <span class="n">test_suite</span> <span class="k">loop</span>
      <span class="k">if</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test that fails on VUnit check procedure&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">check_equal</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
      <span class="k">elsif</span> <span class="n">run</span><span class="p">(</span><span class="s">&quot;Test to_string for boolean&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">check_equal</span><span class="p">(</span><span class="n">to_string</span><span class="p">(</span><span class="n">true</span><span class="p">),</span> <span class="s">&quot;true&quot;</span><span class="p">);</span>
      <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

    <span class="n">info</span><span class="p">(</span><span class="s">&quot;===Summary===&quot;</span> <span class="o">&amp;</span> <span class="n">LF</span> <span class="o">&amp;</span> <span class="n">to_string</span><span class="p">(</span><span class="n">get_checker_stat</span><span class="p">));</span>

    <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>
<span class="k">end</span> <span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
<p>However, since PR hasn’t scanned the code for test cases VUnit doesn’t know how many they are. Instead it will
iterate the while loop as long as there is a call to the <code class="docutils literal notranslate"><span class="pre">run</span></code> function with a test case name VUnit hasn’t
seen before. The first iteration in the example above will run the <em>Test that fails on VUnit check procedure</em> test
case and the second iteration will run <em>Test to_string for boolean</em>. Then there is a third iteration where no
new test case is found. This will trigger VUnit to end the while loop.</p>
<p>The default level for a VUnit check like <code class="docutils literal notranslate"><span class="pre">check_equal</span></code> is <code class="docutils literal notranslate"><span class="pre">error</span></code> and the default behaviour is to stop the
simulation on <code class="docutils literal notranslate"><span class="pre">error</span></code> when running with PR. When running standalone the default behaviour is to stop the
simulation on the <code class="docutils literal notranslate"><span class="pre">failure</span></code> level such that the simulation has the ability to run through all test cases
despite a failing check like in the example above.</p>
<p>Without PR there is a need print the test result. VUnit provides the <code class="docutils literal notranslate"><span class="pre">get_checker_stat</span></code> function to get the
internal error counters and a <code class="docutils literal notranslate"><span class="pre">to_string</span></code> function to convert the returned record to a string. The example
uses that and VUnit logging capabilities to create a simple summary in the test suite cleanup phase.</p>
<p>It’s also useful to print the currently running test case. VR has an internal logger, <code class="docutils literal notranslate"><span class="pre">runner</span></code>, providing
such information. This information is suppressed when running with PR but is enabled in the standalone mode</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>#             0 ps - runner  -    INFO  - Test case: Test that fails on VUnit check procedure
#             0 ps - check   -    ERROR - Equality check failed - Got 17. Expected 18.
#             0 ps - runner  -    INFO  - Test case: Test to_string for boolean
#             0 ps - default -    INFO  - ===Summary===
#                                         checker_stat&#39;(n_checks =&gt; 2, n_failed =&gt; 1, n_passed =&gt; 1)
</pre></div>
</div>
<p>Note that VUnit cannot handle VHDL asserts in this mode of operation. We will have to wait for VHDL-2017 to get
the ability to read error counters based on assert statements. Failures like division by zero or out of range
operations are other examples that won’t be handle gracefully in this mode and not something that VHDL-2017 will
solve.</p>
</div>
<div class="section" id="special-paths">
<h2>Special Paths<a class="headerlink" href="#special-paths" title="Permalink to this headline">¶</a></h2>
<p>When running with PR you can get the path to the directory containing the testbench and the path to the output
directory of the current test by using the <code class="docutils literal notranslate"><span class="pre">tb_path</span></code> and <code class="docutils literal notranslate"><span class="pre">output_path</span></code> generics. This is described in more
detail <a class="reference internal" href="../user_guide.html"><span class="doc">here</span></a>. It’s also possible to access these path strings from the <code class="docutils literal notranslate"><span class="pre">runner_cfg</span></code>
generic by using the <code class="docutils literal notranslate"><span class="pre">tb_path</span></code> and <code class="docutils literal notranslate"><span class="pre">output_path</span></code> functions.</p>
<p>Running the following testbench</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span> <span class="nn">vunit_lib</span><span class="p">;</span>
<span class="n">context</span> <span class="n">vunit_lib</span><span class="p">.</span><span class="n">vunit_context</span><span class="p">;</span>

<span class="k">entity</span> <span class="nc">tb_magic_paths</span> <span class="k">is</span>
  <span class="k">generic</span> <span class="p">(</span><span class="n">runner_cfg</span> <span class="o">:</span> <span class="kt">string</span><span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span><span class="p">;</span>

<span class="k">architecture</span> <span class="nc">tb</span> <span class="k">of</span> <span class="nc">tb_magic_paths</span> <span class="k">is</span>
<span class="k">begin</span>
  <span class="n">test_runner</span> <span class="o">:</span> <span class="k">process</span>
  <span class="k">begin</span>
    <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>
    <span class="n">info</span><span class="p">(</span><span class="s">&quot;Directory containing testbench: &quot;</span> <span class="o">&amp;</span> <span class="n">tb_path</span><span class="p">(</span><span class="n">runner_cfg</span><span class="p">));</span>
    <span class="n">info</span><span class="p">(</span><span class="s">&quot;Test output directory: &quot;</span> <span class="o">&amp;</span> <span class="n">output_path</span><span class="p">(</span><span class="n">runner_cfg</span><span class="p">));</span>
    <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
  <span class="k">end</span> <span class="k">process</span><span class="p">;</span>
<span class="k">end</span> <span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
<p>will reveal that</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> python run.py -v *tb_magic*
<span class="go">Running test: lib.tb_magic_paths.all</span>
<span class="go">Running 1 tests</span>

<span class="go">Starting lib.tb_magic_paths.all</span>
<span class="go">               0 fs - default              -    INFO - Directory containing testbench: d:/Programming/github/vunit/examples/vhdl/run/</span>
<span class="go">               0 fs - default              -    INFO - Test output directory: d:/Programming/github/vunit/examples/vhdl/run/vunit_out/test_output/lib.tb_magic_paths.all_243b3c717ce1d4e82490245d1b7e8fe8797f5e94/</span>
</pre></div>
</div>
</div>
<div class="section" id="note-on-undocumented-features">
<h2>Note On Undocumented Features<a class="headerlink" href="#note-on-undocumented-features" title="Permalink to this headline">¶</a></h2>
<p>VR contains a number of features not documented in this guide. These features are under evaluation and will be
documented or removed when that evaluation has completed.</p>
</div>
</div>

  <div class="section">
  
  
  </div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/VUnit_logo_420x420.png" alt="Logo"/>
    
    <h1 class="logo logo-name">VUnit</h1>
    
  </a>
</p>



<p class="blurb">A test framework for HDL</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=VUnit&repo=vunit&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/VUnit/vunit">
    <img
        alt="https://secure.travis-ci.org/VUnit/vunit.svg?branch=master"
        src="https://secure.travis-ci.org/VUnit/vunit.svg?branch=master"
    />
</a>
</p>


<a class="icon" title="Contact us" href="mailto:vunitframework@gmail.com"><span class="fa fa-envelope fa-2x fa-fw"/></a>
<a class="icon" title="Go to our GitHub Repo" href="https://github.com/VUnit/vunit"><span class="fa fa-github fa-2x fa-fw"/></a>
<a class="icon" title="View our Twitter Feed" href="https://www.twitter.com/VUnitFramework"><span class="fa fa-twitter fa-2x fa-fw"/></a>
<a class="icon" title="View our YouTube Channel" href="https://youtube.com/channel/UCCPVCaeWkz6C95aRUTbIwdg"><span class="fa fa-youtube fa-2x fa-fw"/></a>
<a class="icon" title="Chat with us on Gitter" href="https://gitter.im/VUnit/vunit"><span class="fa fa-weixin fa-2x fa-fw"/></a>

<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">What is VUnit?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py/ui.html">Python Interface</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../vhdl_libraries.html">VHDL Libraries</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../logging/user_guide.html">Logging Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../check/user_guide.html">Check Library</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Run Library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#minimal-vunit-testbench">Minimal VUnit Testbench</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testbench-with-test-cases">Testbench with Test Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distributed-testbenches">Distributed Testbenches</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlling-what-test-cases-to-run">Controlling What Test Cases to Run</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-test-cases-independently">Running Test Cases Independently</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-vunit-watchdog">The VUnit Watchdog</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-makes-a-test-fail">What Makes a Test Fail?</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#stopping-failures">Stopping Failures</a></li>
<li class="toctree-l5"><a class="reference internal" href="#counting-errors-with-vunit-logging-check-libraries">Counting Errors with VUnit Logging/Check Libraries</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#running-a-vunit-testbench-standalone">Running A VUnit Testbench Standalone</a></li>
<li class="toctree-l4"><a class="reference internal" href="#special-paths">Special Paths</a></li>
<li class="toctree-l4"><a class="reference internal" href="#note-on-undocumented-features">Note On Undocumented Features</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../com/user_guide.html">Communication Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../data_types/user_guide.html">Data Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../verification_components/user_guide.html">Verification Component Library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testimonials/testimonials.html">Testimonials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release notes</a></li>
</ul>


  <h3><a href="../blog.html">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../posts/2018_09_22_sigasi_adds_full_vunit_support/post.html">12 September - Sigasi Adds Full VUnit Support</a></li>
    
      <li><a href="../posts/2018_07_22_sigasi_deepens_its_commitment_to_the_vunit_testing_framework/post.html">22 July - Sigasi Deepens Its Commitment to the VUnit Testing Framework</a></li>
    
      <li><a href="../posts/2018_03_22_vunit_community_developed_bfms/post.html">22 March - VUnit Community Developed BFMs</a></li>
    
      <li><a href="../posts/2018_02_12_vunit3/post.html">12 February - VUnit 3.0</a></li>
    
      <li><a href="../posts/2017_12_14_vunit_bfms _as_simple_as_emailing/post.html">14 December - VUnit BFMs - as Simple as Emailing</a></li>
    
  </ul>

  <h3><a href="../blog/tag.html">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../blog/tag/osvvm.html">OSVVM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../blog/tag/vunit.html">VUnit</a></li>
      
    
  </ul>

  <h3><a href="../blog/archive.html">Archives</a></h3>
  <ul>
  
    
    <li><a href="../blog/2018.html">2018 (4)</a></li>
    
  
    
    <li><a href="../blog/2017.html">2017 (7)</a></li>
    
  
    
    <li><a href="../blog/2016.html">2016 (8)</a></li>
    
  
    
    <li><a href="../blog/2015.html">2015 (3)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014-2018, Lars Asplund.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/run/user_guide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>