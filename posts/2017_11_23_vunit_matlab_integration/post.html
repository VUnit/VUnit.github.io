
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>VUnit Matlab Integration &#8212; VUnit  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/vunit.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112393863-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-112393863-1');
</script>

  
  <link rel="alternate" type="application/atom+xml"  href="../../blog/atom.xml" title="VUnit Blog">
  
  
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="vunit-matlab-integration">
<h1>VUnit Matlab Integration<a class="headerlink" href="#vunit-matlab-integration" title="Permalink to this headline">¶</a></h1>
<div class="figure align-center">
<img alt="VUnit Matlab Integration" src="../../_images/image6.jpg" />
</div>
<p>This article was originally posted on <a class="reference external" href="https://www.linkedin.com/pulse/vunit-matlab-integration-lars-asplund/">LinkedIn</a>
where you may find some comments on its contents.</p>
<p>Recently I got a question from an ASIC team if it is possible to
integrate their VUnit simulations with Matlab. I’ve been getting this
question several times lately so this post will show you how it can be
done. It will be based on their use case but hopefully it will serve
as inspiration if you have other Matlab use cases or want to integrate
VUnit with some other program.</p>
<div class="section" id="the-testbench">
<h2>The Testbench<a class="headerlink" href="#the-testbench" title="Permalink to this headline">¶</a></h2>
<p>The ASIC team had a slow high-level testbench that they wanted to
monitor by continuously visualizing the progress of the implemented
algorithm in the form of a Matlab plot. To emulate that slow test I
created a testbench which doesn’t have a DUT implementing an algorithm
but simply generates a sequence of output samples itself. The output
samples are generated by repeatedly calling a function
<cite>get_output_sample</cite> that I made really slow by adding an internal delay
loop. The samples generated form a simple ramp function as shown in
the figure below.</p>
<div class="figure align-center">
<img alt="Testbench Progress" src="../../_images/figure.jpg" />
</div>
<p>Here is the main loop of my VUnit testbench.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="nc">test_runner</span><span class="o">:</span> <span class="k">process</span> <span class="k">is</span>
  <span class="k">variable</span> <span class="n">data_set</span> <span class="o">:</span> <span class="n">integer_array_t</span><span class="p">;</span>
<span class="k">begin</span>
  <span class="n">test_runner_setup</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">runner_cfg</span><span class="p">);</span>

  <span class="k">for</span> <span class="n">set</span> <span class="k">in</span> <span class="mi">1</span> <span class="k">to</span> <span class="n">num_of_data_sets</span> <span class="k">loop</span>
    <span class="n">data_set</span> <span class="o">:=</span> <span class="n">new_1d</span><span class="p">;</span>

    <span class="k">for</span> <span class="n">data</span> <span class="k">in</span> <span class="mi">1</span> <span class="k">to</span> <span class="n">size_of_data_set</span> <span class="k">loop</span>
      <span class="n">append</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">get_output_sample</span><span class="p">);</span>
    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

    <span class="n">save_csv</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">(</span><span class="n">runner_cfg</span><span class="p">),</span> <span class="s">&quot;data_set_&quot;</span> <span class="o">&amp;</span> <span class="n">to_string</span><span class="p">(</span><span class="n">set</span><span class="p">)</span> <span class="o">&amp;</span> <span class="s">&quot;.csv&quot;</span><span class="p">));</span>
    <span class="n">deallocate</span><span class="p">(</span><span class="n">data_set</span><span class="p">);</span>
  <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>

  <span class="n">test_runner_cleanup</span><span class="p">(</span><span class="n">runner</span><span class="p">);</span>
<span class="k">end</span> <span class="k">process</span><span class="p">;</span>
</pre></div>
</div>
<p>The code consists of two nested loops. The inner loop creates a
<cite>data_set</cite> with a number of output samples and the outer loop creates
several such sets. The samples in a data set is the latest progress of
my algorithm, the “progress report” I send to Matlab.</p>
<p><cite>data_set</cite> is declared as an <cite>integer_array_t</cite> from VUnit’s
<cite>integer_array_pkg</cite>. This package allows you to manage one-, two- or
three-dimensional arrays of integers and provides procedures for
storing such arrays on file. Some of you may have seen the VUnit
<cite>array_t</cite> before. <cite>integer_array_t</cite> is basically the same thing but
it’s a regular type rather than a protected type. The reasons for this
were discussed in my previous <a class="reference external" href="https://www.linkedin.com/pulse/vunit-30-while-waiting-vhdl-2017-lars-asplund/?lipi=urn%3Ali%3Apage%3Ad_flagship3_pulse_read%3B5b9rV7igQdWD8WMA5ZZshg%3D%3D">post</a>.</p>
<p>In this case I have a one-dimensional array (a vector) created by</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">data_set</span> <span class="o">:=</span> <span class="n">new_1d</span><span class="p">;</span>
</pre></div>
</div>
<p>The created vecor is empty by default and grows dynamically with every new sample I append.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">append</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">get_output_sample</span><span class="p">);</span>
</pre></div>
</div>
<p>Once I have a complete data set I save that to a CSV file and then
deallocate the data set such that I can repeat the procedure.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">save_csv</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=&gt;</span> <span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">(</span><span class="n">runner_cfg</span><span class="p">),</span> <span class="s">&quot;data_set_&quot;</span> <span class="o">&amp;</span> <span class="n">to_string</span><span class="p">(</span><span class="n">set</span><span class="p">)</span> <span class="o">&amp;</span> <span class="s">&quot;.csv&quot;</span><span class="p">));</span>
<span class="n">deallocate</span><span class="p">(</span><span class="n">data_set</span><span class="p">);</span>
</pre></div>
</div>
<p>The file name probably deserves a comment. <cite>output_path(runner_cfg)</cite> returns a test unique output directory that VUnit provides to the testbench via the ever-present <cite>runner_cfg</cite> generic. I assign a unique name to every CSV file based on the data set number, for example <cite>data_set_3.csv</cite>, and then create the full path by concatenating the directory and file names using the <cite>join</cite> function.</p>
</div>
<div class="section" id="the-run-script">
<h2>The Run Script<a class="headerlink" href="#the-run-script" title="Permalink to this headline">¶</a></h2>
<p>The run script is similar to most run scripts with a few additions</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prj</span> <span class="o">=</span> <span class="n">VUnit</span><span class="o">.</span><span class="n">from_argv</span><span class="p">()</span>
<span class="n">prj</span><span class="o">.</span><span class="n">add_array_util</span><span class="p">()</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="n">lib</span> <span class="o">=</span> <span class="n">prj</span><span class="o">.</span><span class="n">add_library</span><span class="p">(</span><span class="s2">&quot;lib&quot;</span><span class="p">)</span>
<span class="n">lib</span><span class="o">.</span><span class="n">add_source_files</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;*.vhd&quot;</span><span class="p">))</span>
<span class="n">tb_octave</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;tb_octave&quot;</span><span class="p">)</span>

<span class="n">tb_octave</span><span class="o">.</span><span class="n">add_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Passing test&quot;</span><span class="p">,</span>
                     <span class="n">generics</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size_of_data_set</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                   <span class="n">num_of_data_sets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                   <span class="n">activate_bug</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                     <span class="n">pre_config</span><span class="o">=</span><span class="n">make_pre_config</span><span class="p">(</span><span class="s2">&quot;Passing test&quot;</span><span class="p">,</span> <span class="n">num_of_data_sets</span><span class="p">))</span>

<span class="n">prj</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>The VUnit array support is an add-on not compiled into <cite>vunit_lib</cite> by
default. To include it you have to add</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="n">prj</span><span class="p">.</span><span class="n">add_array_util</span><span class="p">()</span>
</pre></div>
</div>
<p>Next I want to create a configuration for my testbench. A VUnit configuration allows me to run my testbench with several different settings. In this example my testbench entity is called <cite>tb_octave</cite> and I get the testbench, compiled into <cite>lib</cite>, with the line</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tb_octave</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="s2">&quot;tb_octave&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the <cite>add_config</cite> method I can now add a configuration to the
testbench which I named <cite>Passing test</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tb_octave</span><span class="o">.</span><span class="n">add_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Passing test&quot;</span><span class="p">,</span>
                     <span class="n">generics</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size_of_data_set</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                   <span class="n">num_of_data_sets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                   <span class="n">activate_bug</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                     <span class="n">pre_config</span><span class="o">=</span><span class="n">make_pre_config</span><span class="p">(</span><span class="n">plot_title</span><span class="o">=</span><span class="s2">&quot;Passing test&quot;</span><span class="p">,</span> <span class="n">num_of_data_sets</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<p>The configuration first sets a number of testbench generics collected
in a Python dictionary (a list of key/value pairs). You’ve already
seen the purpose of <cite>size_of_data_set</cite> and <cite>num_of_data_sets</cite> but I
also have a generic <cite>activate_bug</cite> which I will use later to activate
a bug in the <cite>get_output_sample</cite> function. I’ve also added something
called a <cite>pre_config</cite> function. This is a function that VUnit calls
before starting the simulation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pre_config</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">run</span><span class="p">([</span><span class="s2">&quot;octave&quot;</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;octave&quot;</span><span class="p">,</span> <span class="s2">&quot;visualize.m&quot;</span><span class="p">),</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_of_data_sets</span><span class="p">)])</span>

    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
<p><cite>pre_config</cite> takes a mandatory <cite>output_path</cite> argument which is the
same directory we saw in the testbench before. Note that the
<cite>output_path</cite> name doesn’t mean that it can’t be used for simulation
input. A <cite>pre_config</cite> function can for example be used to generate and
store an input data file in <cite>output_path</cite> and let the testbench read
that data.</p>
<p>In this example I use <cite>pre_config</cite> to call Matlab (or rather Octave
which is a free Matlab clone) using the Python <cite>run</cite> function. Octave
is called with a Matlab M script, <cite>visualize.m</cite>, located in the
<cite>&lt;root&gt;/octave</cite> directory. The script takes three arguments - the
output path where the testbench stores the CSV files to plot, the
title of the plot to be created, and the number of data sets that
Octave should expect.</p>
<p>But where are <cite>plot_title</cite> and <cite>num_of_data_sets</cite> defined? <cite>pre_config</cite> is called by VUnit and it can only provide arguments it knows about. VUnit knows about the <cite>output_path</cite> it created but doesn’t know anything about the purpose of the <cite>pre_config</cite> function and what it needs to fulfill that purpose. I can hardcode these values but what if I want to reuse <cite>pre_config</cite> with different values? The trick is to generate the <cite>pre_config</cite> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_pre_config</span><span class="p">(</span><span class="n">plot_title</span><span class="p">,</span> <span class="n">num_of_data_sets</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pre_config</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">run</span><span class="p">([</span><span class="s2">&quot;octave&quot;</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;octave&quot;</span><span class="p">,</span> <span class="s2">&quot;visualize.m&quot;</span><span class="p">),</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_of_data_sets</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">pre_config</span>
</pre></div>
</div>
<p>The <cite>make_pre_config</cite> function has defined <cite>pre_config</cite> locally and
returns that function to the caller of <cite>make_pre_config</cite>. Since
<cite>figure_title</cite> and <cite>num_of_data_sets</cite> are arguments to
<cite>make_pre_config</cite> they are also visible for <cite>pre_config</cite>, just like
they would be for a local function in VHDL. It might seem strange that
<cite>pre_config</cite> remembers the values of these arguments once the function
has been returned and is used elsewhere. This is known as a closure
and you can read more about it <a class="reference external" href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">here</a>.</p>
</div>
<div class="section" id="the-matlab-script">
<h2>The Matlab Script<a class="headerlink" href="#the-matlab-script" title="Permalink to this headline">¶</a></h2>
<p>I’m not a Matlab programmer but the reference manual helped me creating a script that seems to work. Based on the input arguments it creates a named plot and then waits for input files in the output directory. Every new file is read and appended to the plot. I also added a test to see if the plotted graph is monotonically increasing as intended. If so, the script creates an empty file named <cite>pass</cite>. If not, a file named <cite>fail</cite> is created.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Parse arguments</span>
<span class="n">arg_list</span> <span class="p">=</span> <span class="n">argv</span><span class="p">;</span>
<span class="n">output_path</span> <span class="p">=</span> <span class="n">arg_list</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="n">plot_title</span> <span class="p">=</span> <span class="n">arg_list</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
<span class="n">num_of_data_sets</span> <span class="p">=</span> <span class="n">arg_list</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>

<span class="c">% Configure figure</span>
<span class="n">fig</span> <span class="p">=</span> <span class="n">figure</span><span class="p">(</span><span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="s">&#39;Testbench Progress&#39;</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="n">plot_title</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span>&quot;<span class="n">x</span>&quot;<span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span>&quot;<span class="n">y</span>&quot;<span class="p">)</span>
<span class="n">xlim</span><span class="p">([</span><span class="mi">0</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">ylim</span><span class="p">([</span><span class="mi">0</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">hold</span> <span class="n">on</span>

<span class="c">% Wait on data set files and plot</span>
<span class="n">data</span> <span class="p">=</span> <span class="p">[];</span>
<span class="k">for</span> <span class="n">s</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">str2num</span><span class="p">(</span><span class="n">num_of_data_sets</span><span class="p">)</span>
  <span class="n">file_name</span> <span class="p">=</span> <span class="n">fullfile</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">strcat</span><span class="p">(</span>&quot;<span class="n">data_set_</span>&quot;<span class="p">,</span> <span class="n">int2str</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> &quot;<span class="p">.</span><span class="n">csv</span>&quot;<span class="p">));</span>
  <span class="k">while</span> <span class="n">not</span><span class="p">(</span><span class="n">exist</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">&#39;file&#39;</span><span class="p">))</span>
    <span class="n">pause</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">data_set</span> <span class="p">=</span> <span class="n">csvread</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
  <span class="n">data</span> <span class="p">=</span> <span class="p">[</span><span class="n">data</span><span class="p">,</span> <span class="n">data_set</span><span class="p">];</span>
  <span class="n">x</span> <span class="p">=</span> <span class="mi">0</span> <span class="p">:</span> <span class="nb">length</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="k">end</span>

<span class="c">% Verify that the data set is monotonically increasing</span>
<span class="k">if</span> <span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span><span class="p">=</span> <span class="n">data</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">0</span>
  <span class="n">f</span> <span class="p">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">fullfile</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> &quot;<span class="n">pass</span>&quot;<span class="p">),</span> &quot;<span class="n">w</span>&quot;<span class="p">);</span>
<span class="k">else</span>
  <span class="n">f</span> <span class="p">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">fullfile</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> &quot;<span class="n">fail</span>&quot;<span class="p">),</span> &quot;<span class="n">w</span>&quot;<span class="p">);</span>
  <span class="nb">disp</span><span class="p">(</span>&quot;<span class="n">ERROR</span><span class="p">:</span> <span class="n">Output</span> <span class="n">is</span> <span class="n">not</span> <span class="n">monotonically</span> <span class="n">increasing</span>!&quot;<span class="p">)</span>
<span class="k">end</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>

<span class="c">% Quit when figure is closed</span>
<span class="n">pause</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">waitfor</span><span class="p">(</span><span class="n">fig</span><span class="p">);</span>
</pre></div>
</div>
<p>The next step is to let the pass/fail files determine the faith of my
testbench. This can be done with a VUnit <cite>post_check</cite> function. I
works just like the <cite>pre_config</cite> function but runs after the
testbench.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">post_check</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;pass&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;fail&quot;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<p>If a pass file is found within 10 seconds the function returns <cite>True</cite>,
otherwise <cite>False</cite>. A <cite>pre_config</cite> or <cite>post_check</cite> function returning <cite>False</cite>
will cause my test to fail just like a failing assert within my
testbench would.</p>
</div>
<div class="section" id="putting-it-all-together">
<h2>Putting It All Together<a class="headerlink" href="#putting-it-all-together" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate both the passing and the failing case I’ve created two
configurations for this testbench using a for loop. Note how
<cite>make_pre_config</cite> allows me to reuse the <cite>pre_config</cite> function with
different values for <cite>plot_title</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">size_of_data_set</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">num_of_data_sets</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">activate_bug</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Passing test&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Failing test&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)]:</span>
    <span class="n">tb_octave</span><span class="o">.</span><span class="n">add_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">generics</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size_of_data_set</span><span class="o">=</span><span class="n">size_of_data_set</span><span class="p">,</span>
                                       <span class="n">num_of_data_sets</span><span class="o">=</span><span class="n">num_of_data_sets</span><span class="p">,</span>
                                       <span class="n">activate_bug</span><span class="o">=</span><span class="n">activate_bug</span><span class="p">),</span>
                         <span class="n">pre_config</span><span class="o">=</span><span class="n">make_pre_config</span><span class="p">(</span><span class="n">plot_title</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">num_of_data_sets</span><span class="o">=</span><span class="n">num_of_data_sets</span><span class="p">),</span>
                         <span class="n">post_check</span><span class="o">=</span><span class="n">post_check</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is shown in this short clip</p>
<iframe width="560" height="315"
src="https://www.youtube.com/embed/AnlwP3WSA2s" frameborder="0"
allow="accelerometer; autoplay; encrypted-media; gyroscope;
picture-in-picture" allowfullscreen></iframe><p>The good thing about the solutions I provided is that it makes it is
fairly easy to get started. You can download the code and adapt it for
your needs. If you didn’t know about VUnit configurations and arrays
you’ve also learned something that is useful in many other
situations. However, leaving aside my limited Matlab skills, there are
still a number of flaws with this solution. For example</p>
<ul class="simple">
<li><p>With the CSV support provided by VUnit and Matlab it became easy to
split the data into sets and store them in separate files. I would
prefer writing and reading a single open file.</p></li>
<li><p>Copying and modifying code is not good reuse. I need to raise the
abstraction and remove details.</p></li>
<li><p>Responsibility for the plot is all over the place. The testbench is
in charge of the data, the title is set by the Python script, axis
labels are controlled by the M script, and some properties are
hardcoded.</p></li>
</ul>
<p>It seems that I will have to revisit this post. Until then…</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../2017_11_07_vunit_3_0_while_waiting_for_vhdl_2017/post.html">
    <i class="fa fa-arrow-circle-left"></i>
    VUnit 3.0 - While Waiting for VHDL-2017
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../2017_12_14_vunit_bfms _as_simple_as_emailing/post.html">
    VUnit BFMs - as Simple as Emailing
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'vunitframework';
        var disqus_identifier = '/posts/2017_11_23_vunit_matlab_integration/post/';
        var disqus_title = 'VUnit Matlab Integration';
        var disqus_url = 'http://vunit.github.io/posts/2017_11_23_vunit_matlab_integration/post';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/VUnit_logo_420x420.png" alt="Logo"/>
    
    <h1 class="logo logo-name">VUnit</h1>
    
  </a>
</p>



<p class="blurb">A test framework for HDL</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=VUnit&repo=vunit&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/VUnit/vunit">
    <img
        alt="https://secure.travis-ci.org/VUnit/vunit.svg?branch=master"
        src="https://secure.travis-ci.org/VUnit/vunit.svg?branch=master"
    />
</a>
</p>


<a class="icon" title="Contact us" href="mailto:vunitframework@gmail.com"><span class="fa fa-envelope fa-2x fa-fw"/></a>
<a class="icon" title="Go to our GitHub Repo" href="https://github.com/VUnit/vunit"><span class="fa fa-github fa-2x fa-fw"/></a>
<a class="icon" title="View our Twitter Feed" href="https://www.twitter.com/VUnitFramework"><span class="fa fa-twitter fa-2x fa-fw"/></a>
<a class="icon" title="View our YouTube Channel" href="https://youtube.com/channel/UCCPVCaeWkz6C95aRUTbIwdg"><span class="fa fa-youtube fa-2x fa-fw"/></a>
<a class="icon" title="Chat with us on Gitter" href="https://gitter.im/VUnit/vunit"><span class="fa fa-weixin fa-2x fa-fw"/></a>
  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    23 November 2017
  
  </h2>

  <ul>
    

  
  <li id="author"><span><i class="fa-fw fa fa-user"></i></span>
    
      
      <a href="../../blog/author/lasplund.html">lasplund</a>
      
    </li>
  

  

  

  

  
  <li id="tags"><span><i class="fa-fw fa fa-tag"></i></span>
    
      
      <a href="../../blog/tag/vunit.html">VUnit</a>
      
    </li>
  
  
  <li id="comments">
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vunitframework'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/posts/2017_11_23_vunit_matlab_integration/post/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">What is VUnit?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testimonials/testimonials.html">Testimonials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
</ul>


  <h3><a href="../../blog.html">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../2018_09_22_sigasi_adds_full_vunit_support/post.html">12 September - Sigasi Adds Full VUnit Support</a></li>
    
      <li><a href="../2018_07_22_sigasi_deepens_its_commitment_to_the_vunit_testing_framework/post.html">22 July - Sigasi Deepens Its Commitment to the VUnit Testing Framework</a></li>
    
      <li><a href="../2018_03_22_vunit_community_developed_bfms/post.html">22 March - VUnit Community Developed BFMs</a></li>
    
      <li><a href="../2018_02_12_vunit3/post.html">12 February - VUnit 3.0</a></li>
    
      <li><a href="../2017_12_14_vunit_bfms _as_simple_as_emailing/post.html">14 December - VUnit BFMs - as Simple as Emailing</a></li>
    
  </ul>

  <h3><a href="../../blog/tag.html">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/osvvm.html">OSVVM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../../blog/tag/vunit.html">VUnit</a></li>
      
    
  </ul>

  <h3><a href="../../blog/archive.html">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../blog/2018.html">2018 (4)</a></li>
    
  
    
    <li><a href="../../blog/2017.html">2017 (7)</a></li>
    
  
    
    <li><a href="../../blog/2016.html">2016 (8)</a></li>
    
  
    
    <li><a href="../../blog/2015.html">2015 (3)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014-2018, Lars Asplund.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/posts/2017_11_23_vunit_matlab_integration/post.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>